apiVersion: apps/v1 # for versions before 1.9.0 use apps/v1beta2
kind: Deployment
metadata:
  annotations:
  labels:
    k8s-app: chaincode-${HOSTNAME}
    io.kompose.service: chaincode-${HOSTNAME}
  name: chaincode
  namespace: ${KUBENS}
spec:
  selector:
    matchLabels:
      app: chaincode-${HOSTNAME}
  strategy:
    type: Recreate
  template:
    metadata:
      annotations:
      labels:
#        io.kompose.network/kubefile_gsmawr_msp: "true"
        io.kompose.service: chaincode-${HOSTNAME}
        app: chaincode-${HOSTNAME}
    spec:
      containers:
      - image: ${IMAGE_CHAINCODE}
        name: chaincode-${HOSTNAME}
        imagePullPolicy: IfNotPresent
        env:
          - name: CHAINCODE_CCID
            value: "${CHAINCODE_CCID}"
          - name: CHAINCODE_ADDRESS
            value: ${CHAINCODE_SELF_ADDRESS}
          - name: CORE_PEER_LOCALMSPID
            value: ${ORG}MSP
        ports:
        - containerPort: 7052
          name: chaincode-
      imagePullSecrets:
      - name: nomad-secret
      hostname: chaincode-${HOSTNAME}
      dnsPolicy: ClusterFirst
      restartPolicy: Always